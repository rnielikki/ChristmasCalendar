@page "/"
@inject joulukalenteri.Client.Services.Validator validator
@inject joulukalenteri.Client.Services.DayReader reader
@inject joulukalenteri.Client.Services.DaysShuffler shuffler
@inject IModalService Modal
@inject joulukalenteri.Shared.IDateTime datetime
@inject Microsoft.Extensions.Configuration.IConfiguration config
@using joulukalenteri.Shared

<div class="calendar-wrapper wrapper">
    <h1>@(config["title"]??"Advent Calendar")</h1>
    <div class="calendar">
        @{
            int[] shuffled = shuffler.ShuffleDays();
            for (int i = 0; i < 25; i++)
            {
                int dayValue = shuffled[i];
                if (validator.IsOpenToday(dayValue))
                {
                    <div class="calendar-open" @onclick="(async ()=>await OpenDialog(dayValue))">@dayValue</div>
                }
                else
                {
                    <div class="calendar-closed">@dayValue</div>
                }
            }
        }
    </div>
</div>
@code{
        private async Task OpenDialog(int day)
        {
            DayInfoData data = await reader.GetContent(day);
            ModalParameters modalParams = new ModalParameters();
            modalParams.Add(nameof(DaysModal.DayInfo), data);
            Modal.Show<DaysModal>($"Day {day}: {data.Title}", modalParams);
        }
}