@page "/"
@inject IModalService Modal

@*
    more abot blazor modal from here <3    
    https://github.com/Blazored/Modal
*@


<div class="calendar-wrapper">
<h1>Joulukalenteri</h1>
<div class="calendar">
    @{
        int[] shuffled = ShuffleDays();
        for (int i = 0; i < 25; i++)
        {
            int dayValue = shuffled[i];
            if (IsOpenToday(dayValue))
            {
                <div class="calendar-open" @onclick="(()=>OpenDialog(dayValue))">@dayValue</div>
            }
            else
            {
                <div class="calendar-closed">@dayValue</div>
            }
        }
    }
</div>
</div>

@functions{
    public int[] ShuffleDays()
    {
        Random random = new Random(DateTime.Now.Year);
        int[] result = Enumerable.Range(1, 25).ToArray();
        for (int i = 0; i < 25; i++)
        {
            Swap(ref result[i], ref result[random.Next(i, 24)]);
        }
        return result;
    }

    private void Swap(ref int x, ref int y)
    {
        int temp = x;
        x = y;
        y = temp;
    }

    private void OpenDialog(int value) {
        ModalParameters modalParams = new ModalParameters();
        modalParams.Add("Day", value);
        Modal.Show<DaysModal>("Test", modalParams);
    }

    public bool IsOpenToday(int targetDay) {
        if (DateTime.Now.Month != 12 || DateTime.Now.Day < targetDay)
        {
            return false;
        }
        else{
            return true;
        }
    }
}