using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using joulukalenteri.Client.SharedCode;
using Xunit;

namespace joulukalenteriTests.Integration
{
    public class ArchiveOpenTest : IClassFixture<WebFactory<joulukalenteri.Server.Startup>>
    {
        private readonly WebFactory<joulukalenteri.Server.Startup> _factory;
        private string url;
        public ArchiveOpenTest(WebFactory<joulukalenteri.Server.Startup> factory)
        {
            _factory = factory;
            url = _factory.Server.BaseAddress.ToString();
        }
        [Fact]
        public async Task ArchiveTest()
        {
            var client = _factory.CreateClient();
            ArchiveReader reader = new ArchiveReader(new DataReceiver(client));

            IEnumerable<int> years = await reader.GetYears(url);
            Assert.Equal(new int[] { 2015, 2018 }, years);
            IEnumerable<int> days = await reader.GetDays(2015, url);
            Assert.Equal(new int[] { 1, 3, 12, 21 }, days.OrderBy(a => a));
            IEnumerable<int> future = await reader.GetDays(2099, url);
            Assert.Equal(new int[] { }, future);
        }
    }
}
