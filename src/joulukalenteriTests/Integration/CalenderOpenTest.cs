using System;
using System.Collections.Generic;
using System.Text;
using Microsoft.AspNetCore.Mvc;
using System.Threading.Tasks;
using Xunit;
using joulukalenteri.Client.SharedCode;
using Microsoft.AspNetCore.Components;
using joulukalenteri.Shared;
using Pose;

namespace joulukalenteriTests.Integration
{
    public class CalendarOpenTest : IClassFixture<WebFactory<joulukalenteri.Server.Startup>>
    {
        private readonly WebFactory<joulukalenteri.Server.Startup> _factory;
        public CalendarOpenTest(WebFactory<joulukalenteri.Server.Startup> factory) {
            _factory = factory;
        }
        [Fact]
        public async Task ReadAndParseTest(){
            var client = _factory.CreateClient();
            int day = 5;
            DayReader reader = new DayReader(new DataReceiver(client));

            DayInfoData data = await reader.GetContent(2018,5, _factory.Server.BaseAddress.ToString());
            Assert.Equal("Insert Your title here.", data?.Title);
            Assert.Equal("asdf", data?.Summary);
            Assert.Equal(day, data?.Day);

            //response.EnsureSuccessStatusCode();
            //string test = await response.Content.ReadAsStringAsync();
            //Assert.NotEqual("{\"2018\":[]}", test);
        }
    }
}
